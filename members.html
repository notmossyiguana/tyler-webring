<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Members â€” Tyler the Creator Webring</title>
  <link rel="icon" href="images/icon.png" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* keep the original vertical list look */
    .member {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 1.2rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--border);
    }

    .member:last-child {
      border-bottom: none;
    }

    .member img {
      width: 88px;
      height: 31px;
      object-fit: contain;
      border: 1px solid var(--border);
      background: white;
    }

    .member-info {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .member-name {
      font-family: 'TylerFont', system-ui, sans-serif;
      font-size: 1.1rem;
      font-weight: bold;
    }

    .member-site a {
      color: var(--accent);
      text-decoration: none;
    }

    .member-site a:hover {
      text-decoration: underline;
    }

    .member-blurb {
      font-size: 0.9rem;
      color: var(--muted);
    }

    #memberlist {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <header>
<img src="https://mossyscorner.neocities.org/images/title.gif" 
     alt="Tyler the Creator Webring title" 
     style="height:100px; object-fit:contain;">
    </header>

    <nav>
      <a class="box" href="webring.html">Home</a>
      <a class="box" href="join.html">Join</a>
      <a class="box" href="members.html">Members</a>
    </nav>

    <main>
      <section class="panel">
        <h2>Members</h2>
        <div id="memberlist" aria-live="polite">Loading members...</div>
      </section>
    </main>

    <footer>
      For edits or removal, email <strong>tylerwebring [at] duck [dot] com</strong>
    </footer>
  </div>

  <script>
    async function loadMembers() {
      const container = document.getElementById('memberlist');
      try {
        const res = await fetch('https://raw.githubusercontent.com/notmossyiguana/tyler-webring/refs/heads/main/members.json', { cache: "no-store" });
        if (!res.ok) {
          container.textContent = "No member list found.";
          return;
        }

        const raw = await res.text();
        const blocks = raw.trim().split(/\n\s*\n/).filter(Boolean);
        if (blocks[0].trim().startsWith('---')) blocks.shift();

        const members = blocks.map(block => {
          const obj = {};
          block.split('\n').forEach(line => {
            const idx = line.indexOf(':');
            if (idx < 0) return;
            const key = line.slice(0, idx).trim();
            const val = line.slice(idx + 1).trim();
            obj[key] = val;
          });
          return obj;
        }).filter(m => m.name);

        container.innerHTML = members.map(m => `
          <div class="member">
            ${m.button ? `<img src="button/${escapeHtml(m.button)}" alt="${escapeHtml(m.name)} button" loading="lazy">` : ""}
            <div class="member-info">
              <div class="member-name">${escapeHtml(m.name)}</div>
              ${m.site ? `<div class="member-site"><a href="${formatSite(m.site)}" target="_blank">${escapeHtml(m.site)}</a></div>` : ""}
              ${m.blurb ? `<div class="member-blurb">${escapeHtml(m.blurb)}</div>` : ""}
            </div>
          </div>
        `).join('') || "No members listed yet.";
      } catch (err) {
        container.textContent = "Error loading members.";
        console.error(err);
      }
    }

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, c => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      }[c]));
    }

    function formatSite(url) {
      return url.startsWith('http') ? url : 'https://' + url;
    }

    loadMembers();
  </script>
</body>
</html>
